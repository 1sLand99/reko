// pySample.c
// Generated by decompiling C:\MyPrograms\git_repos\reko_ptomin\subjects\regressions\pySample\pySample.dll
// using Decompiler version 0.5.5.0.

#include "pySample.h"

PyObject * py_unused(PyObject * self, PyObject * args)
{
	word32 eax_9 = PyArg_ParseTuple(args, 0x1000216C, tArg00);
	if (eax_9 != 0x00)
	{
		word32 eax_17 = _Py_NoneStruct;
		Mem20[eax_17 + 0x00:word32] = Mem0[eax_17 + 0x00:word32] + 0x01;
		return _Py_NoneStruct;
	}
	else
		return eax_9;
}

void initpySample()
{
	Py_InitModule4(0x10002174, 0x10003010, 0x00, 0x00, 1007);
	return;
}

word32 fn100011E9(word32 dwArg08)
{
	word32 eax_209;
	if (dwArg08 == 0x00)
	{
		if (Mem0[0x10003070:word32] <= 0x00)
		{
			eax_209 = 0x00;
			return eax_209;
		}
		Mem393[0x10003070:word32] = Mem0[0x10003070:word32] - 0x01;
	}
	word32 ecx_34 = Mem0[_adjust_fdiv + 0x00:word32];
	Mem44[0x100033A4:word32] = ecx_34;
	if (dwArg08 == 0x01)
	{
		word32 edi_79 = Mem44[Mem44[fs:0x18:word32] + 0x04:word32];
		while (true)
		{
			Mem88[fp - 0x1C + 0x00:word32] = 268448684;
			word32 eax_89 = InterlockedCompareExchange(268448684, edi_79, 0x00);
			if (eax_89 == 0x00)
				break;
			if (eax_89 == edi_79)
				goto l10001258;
			Mem236[fp - 0x14 + 0x00:word32] = 1000;
			Sleep(0x00);
			Mem239[fp - 0x14 + 0x00:word32] = 0x00;
		}
l10001258:
		word32 esp_112;
		word32 ebp_111;
		word32 ebx_110;
		word32 esi_109;
		word32 edi_108;
		word32 eax_96 = Mem88[0x100033A8:word32];
		Mem101[fp - 0x14 + 0x00:word32] = 0x02;
		if (eax_96 != 0x00)
		{
			Mem170[fp - 0x14 + 0x00:word32] = 0x1F;
			word32 esp_171;
			word32 eax_172;
			byte SZO_174;
			byte C_175;
			byte SCZO_176;
			byte Z_177;
			word32 ecx_178;
			selector fs_182;
			_amsg_exit();
			esp_112 = fp + ~0x17;
		}
		else
		{
			Mem185[fp - 0x14 + 0x00:word32] = 0x100020A8;
			Mem188[0x100033A8:word32] = 0x01;
			word32 esp_189;
			word32 eax_190;
			word32 ebp_191;
			byte SZO_192;
			byte C_193;
			byte SCZO_194;
			byte Z_195;
			word32 ecx_196;
			word32 ebx_197;
			word32 esi_198;
			word32 edi_199;
			selector fs_200;
			_initterm_e();
			if (eax_190 != 0x00)
			{
				eax_209 = 0x00;
				return eax_209;
			}
			Mem213[fp + ~0x17:word32] = 0x1000209C;
			Mem215[fp + ~0x1B:word32] = 0x10002098;
			word32 esp_216;
			word32 eax_217;
			byte SZO_219;
			byte C_220;
			byte SCZO_221;
			byte Z_222;
			word32 ecx_223;
			selector fs_227;
			_initterm();
			Mem232[0x100033A8:word32] = 0x02;
			esp_112 = fp + ~0x1B;
		}
		word32 esp_117 = esp_112 + 0x04;
		if (ebp_111 == 0x00)
		{
			Mem164[esp_117 - 0x04 + 0x00:word32] = ebp_111;
			Mem166[esp_117 - 0x08 + 0x00:word32] = 268448684;
			InterlockedExchange(Mem166[esp_117 - 0x08 + 0x00:(ptr LONG)], Mem166[esp_117 - 0x04 + 0x00:LONG]);
		}
		if (Mem101[0x100033B8:word32] != 0x00)
		{
			word32 esp_136 = esp_117 - 0x04;
			Mem137[esp_136 + 0x00:word32] = 0x100033B8;
			word32 edi_138;
			word32 eax_139 = fn10001742(ebx_110, esi_109, edi_108, out edi_138);
			if (eax_139 != 0x00)
			{
				Mem146[esp_136 + 0x00:word32] = Mem137[esp_136 + 0x1C:word32];
				Mem148[esp_136 - 0x04 + 0x00:word32] = edi_138;
				Mem150[esp_136 - 0x08 + 0x00:word32] = Mem148[esp_136 + 0x14:word32];
				word32 esp_151;
				word32 eax_152;
				word32 ebp_153;
				byte SZO_154;
				byte C_155;
				byte SCZO_156;
				byte Z_157;
				word32 ecx_158;
				word32 ebx_159;
				word32 esi_160;
				word32 edi_161;
				selector fs_162;
				Mem150[0x100033B8:word32]();
			}
		}
		Mem134[0x10003070:word32] = Mem101[0x10003070:word32] + 0x01;
	}
	else if (dwArg08 == 0x00)
	{
		while (true)
		{
			Mem251[fp - 0x14 + 0x00:word32] = 0x00;
			Mem253[fp - 0x18 + 0x00:word32] = 0x01;
			Mem255[fp - 0x1C + 0x00:word32] = 268448684;
			if (InterlockedCompareExchange(268448684, 0x01, 1000) == 0x00)
				break;
			Mem388[fp - 0x14 + 0x00:word32] = 1000;
			Sleep(0x00);
		}
		word32 eax_261 = Mem255[0x100033A8:word32];
		if (eax_261 != 0x02)
		{
			Mem265[fp - 0x14 + 0x00:word32] = 0x1F;
			word32 esp_266;
			word32 eax_267;
			word32 ebp_268;
			byte SZO_269;
			byte C_270;
			byte SCZO_271;
			byte Z_272;
			word32 ecx_273;
			word32 ebx_274;
			word32 esi_275;
			word32 edi_276;
			selector fs_277;
			_amsg_exit();
		}
		else
		{
			Mem282[fp - 0x14 + 0x00:word32] = Mem255[0x100033B4:word32];
			word32 esp_284;
			word32 eax_285;
			word32 ebp_286;
			byte SZO_287;
			byte C_288;
			byte SCZO_289;
			byte Z_290;
			word32 ecx_291;
			word32 ebx_292;
			word32 esi_293;
			word32 edi_294;
			selector fs_295;
			_decode_pointer();
			word32 esp_302 = fp + ~0x13;
			if (eax_285 != 0x00)
			{
				Mem322[fp + ~0x17:word32] = Mem282[0x100033B0:word32];
				word32 esp_323;
				word32 eax_324;
				word32 ebp_325;
				byte SZO_326;
				byte C_327;
				byte SCZO_328;
				byte Z_329;
				word32 ecx_330;
				word32 esi_332;
				word32 edi_333;
				selector fs_334;
				word32 ebx_331;
				_decode_pointer();
				word32 edi_338 = eax_324;
				while (true)
				{
					edi_338 = edi_338 - 0x04;
					if (edi_338 <u ebx_331)
						break;
					word32 eax_371 = Mem322[edi_338 + 0x00:word32];
					if (eax_371 != 0x00)
					{
						word32 esp_375;
						word32 eax_376;
						word32 ebp_377;
						byte SZO_378;
						byte C_379;
						byte SCZO_380;
						byte Z_381;
						word32 ecx_382;
						word32 esi_384;
						selector fs_386;
						eax_371();
					}
				}
				Mem353[fp + ~0x1B:word32] = ebx_331;
				free(268448684);
				word32 esp_356;
				word32 eax_357;
				word32 ebp_358;
				byte SZO_359;
				byte C_360;
				byte SCZO_361;
				byte Z_362;
				word32 ecx_363;
				word32 ebx_364;
				word32 esi_365;
				word32 edi_366;
				selector fs_367;
				_encoded_null();
				Mem369[0x100033B0:word32] = eax_357;
				Mem370[0x100033B4:word32] = eax_357;
				esp_302 = fp + ~0x1B;
			}
			word32 esp_314 = esp_302 - 0x04;
			Mem315[esp_314 + 0x00:word32] = 0x00;
			Mem317[esp_314 - 0x04 + 0x00:word32] = 268448684;
			Mem318[0x100033A8:word32] = 0x00;
			InterlockedExchange(Mem318[esp_314 - 0x04 + 0x00:(ptr LONG)], Mem318[esp_314 + 0x00:LONG]);
		}
	}
	eax_209 = 0x01;
	return eax_209;
}

void fn10001388(word32 ecx, word32 edx, word32 ebx, word32 esi, word32 edi)
{
	word32 ebp_10 = fn100017E8(ebx, esi, edi, dwLoc0C, 0x100021E8, 0x10);
	word32 ebx_158 = Mem0[ebp_10 + 0x08:word32];
	Mem19[ebp_10 - 0x1C + 0x00:word32] = 0x01;
	Mem21[ebp_10 - 0x04 + 0x00:word32] = 0x00;
	Mem22[0x10003008:word32] = edx;
	Mem23[ebp_10 - 0x04 + 0x00:word32] = 0x01;
	word32 esp_175 = fp - 0x08;
	word32 edi_12 = ecx;
	word32 esi_14 = edx;
	if (edx == 0x00 && Mem23[0x10003070:word32] == 0x00)
	{
		Mem217[ebp_10 - 0x1C + 0x00:word32] = 0x00;
		goto l1000147A;
	}
	if (edx == 0x01 || edx == 0x02)
	{
		word32 eax_165 = Mem23[0x100020CC:word32];
		if (eax_165 != 0x00)
		{
			Mem195[fp - 0x0C + 0x00:word32] = ecx;
			Mem197[fp - 0x10 + 0x00:word32] = edx;
			Mem199[fp - 0x14 + 0x00:word32] = ebx_158;
			word32 ecx_202;
			word32 edx_204;
			word32 eax_207;
			byte SZO_208;
			byte C_209;
			byte SCZO_210;
			byte Z_211;
			eax_165();
			Mem212[ebp_10 - 0x1C + 0x00:word32] = eax_207;
		}
		if (Mem23[ebp_10 - 0x1C + 0x00:word32] == 0x00)
		{
l1000147A:
			Mem35[ebp_10 - 0x04 + 0x00:word32] = Mem23[ebp_10 - 0x04 + 0x00:word32] & 0x00;
			Mem38[ebp_10 - 0x04 + 0x00:word32] = ~0x01;
			fn10001493();
			fn1000182D(ebp_10, 0x10, dwArg00, dwArg04, dwArg08, dwArg0C);
			return;
		}
		word32 esp_182 = esp_175 - 0x04;
		Mem183[esp_182 + 0x00:word32] = edi_12;
		Mem185[esp_182 - 0x04 + 0x00:word32] = esi_14;
		Mem187[esp_182 - 0x08 + 0x00:word32] = ebx_158;
		word32 eax_188 = fn100011E9(dwArg04);
		Mem190[ebp_10 - 0x1C + 0x00:word32] = eax_188;
		esp_175 = esp_182 + 0x04;
		if (eax_188 == 0x00)
			goto l1000147A;
	}
	word32 esp_56 = esp_175 - 0x04;
	Mem57[esp_56 + 0x00:word32] = edi_12;
	Mem59[esp_56 - 0x04 + 0x00:word32] = esi_14;
	Mem61[esp_56 - 0x08 + 0x00:word32] = ebx_158;
	word32 eax_62 = fn100017C6(0x10, dwArg04);
	Mem64[ebp_10 - 0x1C + 0x00:word32] = eax_62;
	word32 esp_142 = esp_56 + 0x04;
	if (esi_14 == 0x01 && eax_62 == 0x00)
	{
		Mem128[esp_56 + 0x00:word32] = edi_12;
		Mem130[esp_56 - 0x04 + 0x00:word32] = eax_62;
		Mem132[esp_56 - 0x08 + 0x00:word32] = ebx_158;
		fn100017C6(0x10, dwArg04);
		Mem136[esp_56 + 0x00:word32] = edi_12;
		Mem138[esp_56 - 0x04 + 0x00:word32] = 0x00;
		Mem140[esp_56 - 0x08 + 0x00:word32] = ebx_158;
		fn100011E9(dwArg04);
		esp_142 = esp_56 + 0x04;
		word32 eax_143 = Mem140[0x100020CC:word32];
		if (eax_143 != 0x00)
		{
			Mem148[esp_56 + 0x00:word32] = edi_12;
			Mem150[esp_56 - 0x04 + 0x00:word32] = 0x00;
			Mem152[esp_56 - 0x08 + 0x00:word32] = ebx_158;
			word32 ecx_155;
			word32 edx_157;
			word32 eax_160;
			byte SZO_161;
			byte C_162;
			byte SCZO_163;
			byte Z_164;
			eax_143();
		}
	}
	if (esi_14 == 0x00 || esi_14 == 0x03)
	{
		word32 esp_80 = esp_142 - 0x04;
		Mem81[esp_80 + 0x00:word32] = edi_12;
		Mem83[esp_80 - 0x04 + 0x00:word32] = esi_14;
		Mem85[esp_80 - 0x08 + 0x00:word32] = ebx_158;
		word32 eax_86 = fn100011E9(dwArg04);
		if (eax_86 == 0x00)
			Mem119[ebp_10 - 0x1C + 0x00:word32] = Mem85[ebp_10 - 0x1C + 0x00:word32] & eax_86;
		if (Mem85[ebp_10 - 0x1C + 0x00:word32] != 0x00)
		{
			word32 eax_95 = Mem85[0x100020CC:word32];
			if (eax_95 != 0x00)
			{
				Mem100[esp_80 + 0x00:word32] = edi_12;
				Mem102[esp_80 - 0x04 + 0x00:word32] = esi_14;
				Mem104[esp_80 - 0x08 + 0x00:word32] = ebx_158;
				word32 esp_105;
				word32 edi_106;
				word32 ecx_107;
				word32 esi_108;
				word32 edx_109;
				word32 ebx_110;
				word32 eax_112;
				byte SZO_113;
				byte C_114;
				byte SCZO_115;
				byte Z_116;
				eax_95();
				Mem117[ebp_10 - 0x1C + 0x00:word32] = eax_112;
			}
		}
	}
	goto l1000147A;
}

void fn10001493()
{
	Mem2[0x10003008:word32] = ~0x00;
	return;
}

void fn1000149E(word32 ebx, word32 esi, word32 edi, word32 dwArg00, word32 dwArg08, word32 dwArg0C)
{
	if (dwArg08 == 0x01)
		fn10001864();
	fn10001388(dwArg0C, dwArg08, ebx, esi, edi);
	return;
}

word32 fn100016D0(word32 dwArg04)
{
	if (Mem0[dwArg04 + 0x00:word16] == 23117)
	{
		word32 eax_21 = Mem0[dwArg04 + 0x3C:word32] + dwArg04;
		if (Mem0[eax_21 + 0x00:word32] == 0x4550)
			return (word32) (Mem0[eax_21 + 0x18:word16] == 0x010B);
	}
	return 0x00;
}

word32 fn10001700(word32 dwArg04, word32 dwArg08)
{
	word32 ecx_6 = Mem0[dwArg04 + 0x3C:word32] + dwArg04;
	word32 esi_14 = (word32) Mem0[ecx_6 + 0x06:word16];
	word32 edx_15 = 0x00;
	word32 eax_22 = (word32) Mem0[ecx_6 + 0x14:word16] + 0x18 + ecx_6 + 0x0C;
	if (true)
		do
		{
			word32 ecx_49 = Mem0[eax_22 + 0x00:word32];
			if (dwArg08 >=u ecx_49 && dwArg08 <u Mem0[eax_22 + 0x08:word32] + ecx_49)
				return eax_22;
			edx_15 = edx_15 + 0x01;
			eax_22 = eax_22 + 0x28;
		} while (edx_15 <u esi_14);
	eax_22 = 0x00;
	return eax_22;
}

word32 fn10001742(word32 ebx, word32 esi, word32 edi, ptr32 ediOut)
{
	word32 eax_31;
	word32 ebp_10 = fn100017E8(ebx, esi, edi, dwLoc0C, 0x10002230, 0x08);
	Mem13[ebp_10 - 0x04 + 0x00:word32] = Mem0[ebp_10 - 0x04 + 0x00:word32] & 0x00;
	Mem18[fp - 0x0C + 0x00:word32] = 0x10000000;
	if (fn100016D0(dwArg00) != 0x00)
	{
		Mem51[fp - 0x0C + 0x00:word32] = Mem18[ebp_10 + 0x08:word32] - 0x10000000;
		Mem53[fp - 0x10 + 0x00:word32] = 0x10000000;
		word32 eax_54 = fn10001700(dwArg00, dwArg04);
		if (eax_54 != 0x00)
		{
			eax_31 = ~(Mem53[eax_54 + 0x24:word32] >>u 0x1F) & 0x01;
			Mem68[ebp_10 - 0x04 + 0x00:word32] = ~0x01;
l100017A8:
			word32 edi_37;
			*ediOut = fn1000182D(ebp_10, 0x08, dwArg00, dwArg04, dwArg08, dwArg0C);
			return eax_31;
		}
	}
	Mem43[ebp_10 - 0x04 + 0x00:word32] = ~0x01;
	eax_31 = 0x00;
	goto l100017A8;
}

word32 fn100017C6(word32 dwArg00, word32 dwArg08)
{
	if (dwArg08 == 0x01 && Mem0[0x100020CC:word32] == 0x00)
		DisableThreadLibraryCalls(dwArg00);
	return 0x01;
}

word32 fn100017E8(word32 ebx, word32 esi, word32 edi, word32 dwArg00, word32 dwArg04, word32 dwArg08)
{
	word32 esp_13 = fp - 0x08 - dwArg08;
	Mem16[esp_13 - 0x04 + 0x00:word32] = ebx;
	Mem19[esp_13 - 0x08 + 0x00:word32] = esi;
	Mem22[esp_13 - 0x0C + 0x00:word32] = edi;
	Mem32[esp_13 - 0x10 + 0x00:word32] = Mem22[0x10003000:word32] ^ fp + 0x08;
	Mem36[esp_13 - 0x14 + 0x00:word32] = dwArg00;
	Mem41[fs:0x00:word32] = fp - 0x08;
	return fp + 0x08;
}

word32 fn1000182D(word32 ebp, word32 dwArg00, word32 dwArg04, word32 dwArg08, word32 dwArg0C, word32 dwArg10)
{
	Mem5[fs:0x00:word32] = Mem0[ebp - 0x10 + 0x00:word32];
	Mem25[ebp + 0x00:word32] = dwArg00;
	return dwArg08;
}

void fn10001864()
{
	word32 eax_8 = Mem0[0x10003000:word32];
	if (eax_8 != 0xBB40E64E && (eax_8 & 0xFFFF0000) != 0x00)
		Mem94[0x10003004:word32] = ~eax_8;
	else
	{
		GetSystemTimeAsFileTime(fp - 0x0C);
		word32 esi_58 = dwLoc08 & 0x00 ^ dwLoc0C & 0x00 ^ GetCurrentProcessId() ^ GetCurrentThreadId() ^ GetTickCount();
		QueryPerformanceCounter(fp - 0x14);
		word32 esi_68 = esi_58 ^ (dwLoc10 ^ dwLoc14);
		if (esi_68 == 0xBB40E64E)
			esi_68 = ~0x44BF19B0;
		else if ((esi_68 & 0xFFFF0000) == 0x00)
			esi_68 = esi_68 | esi_68 << 0x10;
		Mem76[0x10003000:word32] = esi_68;
		Mem78[0x10003004:word32] = ~esi_68;
	}
	return;
}

